<% layout("/layouts/boilerplate") %>

<style>

    .blog-container {
        text-align: center;
    }

    .blog-container{
        .add-blog, #blogPosts {
            margin: 2rem 0;
        }
        
        .add-blog form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
        }
        
        input, textarea {
            width: 80%;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 0.5rem;
            font-size: 1rem;
        }
        
        /* Blog post styling */
        .blog-post {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            text-align: left;
        }
        
        .blog-post h3 {
            color: #007bff;
            margin: 0;
        }
        
        .blog-post img {
            max-width: 100%;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        
        .blog-post .likes {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #ff4757;
            font-weight: bold;
            cursor: pointer;
        }
        
        .likes .like-count {
            font-weight: normal;
        }
    }
        
    /* Blog Post Styling */
    .blogs-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        gap: 2rem;
    }

    .blog-post {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        padding: 20px;
        width: 90%;
        max-width: 900px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
    }

    .blog-post:hover {
        transform: translateY(-8px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    .blog-post h2 {
        font-size: 2rem;
        color: #333;
        text-align: center;
        margin-bottom: 1rem;
    }

    .blog-post p {
        font-size: 1.1rem;
        color: #555;
        line-height: 1.6;
        margin-bottom: 1rem;
    }

    .blog-post p:nth-of-type(2), .blog-post p:nth-of-type(3) {
        font-size: 0.95rem;
        color: #777;
    }

    .blog-image {
        width: 100%;
        max-height: 350px;
        object-fit: cover;
        border-radius: 6px;
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }

    /* Like Button Styling */
    .like-btn {
        background: none;
        border: none;
        color: #e63946;
        cursor: pointer;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: color 0.3s ease;
    }

    .like-btn:hover {
        color: #c02733;
    }

    .like-btn span {
        font-size: 1.2rem;
    }
</style>

<!-- Blog Section -->
<main class="blog-container container mt-4">
    <div class="welcome-header mb-4 text-center">
        <% if (currUser) { %>
            <h1 style="font-family: rakkas;">Welcome back, <%= currUser.username %>! ✈️</h1>
            <p>Ready to share your latest adventure with the Aerovia community?</p>
        <% } else { %>
            <h1 style="font-family: rakkas;">Explore Travel Stories</h1>
            <p>Join us to share your own amazing journeys!</p>
        <% } %>
    </div>

    <% if (currUser) { %>
    <section class="add-blog shadow-sm p-4 mb-5 bg-body rounded border">
        <h3 class="mb-3" style="font-family: rakkas;">Share Your Story</h3>
        <form id="blogForm" action="/blogs" method="POST" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <input type="text" name="blog[title]" class="form-control" placeholder="Catchy Title" required>
                </div>
                <div class="col-md-6 mb-3">
                    <input type="text" name="blog[location]" class="form-control" placeholder="Where did you go?" required>
                </div>
            </div>
            <textarea name="blog[content]" class="form-control mb-3" placeholder="Describe your experience..." rows="4" required></textarea>
            <div class="mb-3">
                <label for="image" class="form-label">Add a Photo</label>
                <input type="file" name="blog[image]" class="form-control" id="image" accept="image/*">
            </div>
            <button type="submit" class="btn btn-danger w-100">Post Story</button>
        </form>
    </section>
    <% } %>

    <div class="blogs-section row">
        <% blogs.forEach(blog => { %>
            <div class="col-12 mb-4">
                <div class="card blog-card h-100 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h2 class="card-title h4 m-0"><%= blog.title %></h2>
                            <small class="text-muted"><%= new Date(blog.createdAt).toLocaleDateString() %></small>
                        </div>
                        <h6 class="text-danger"><i class="fa-solid fa-location-dot"></i> <%= blog.location %></h6>
                        <p class="card-text mt-3"><%= blog.content %></p>
                        
                        <% if (blog.images && blog.images.length > 0) { %>
                            <div class="blog-image-wrapper mb-3">
                                <img src="<%= blog.images[0].imgUrl %>" class="img-fluid rounded" alt="Travel Image">
                            </div>
                        <% } %>

                        <div class="d-flex justify-content-between align-items-center mt-3 border-top pt-2">
                            <span class="text-muted small">By: <strong><%= blog.blogOwner ? blog.blogOwner.username : 'Unknown' %></strong></span>
                            
                            <div class="actions">
                                <button class="btn btn-sm btn-light border like-btn" onclick="likeBlog('<%= blog._id %>')">
                                    ❤️ <span id="likes-<%= blog._id %>"><%= blog.likes || 0 %></span>
                                </button>
                                
                                <% if (currUser && blog.blogOwner && currUser._id.equals(blog.blogOwner._id)) { %>
                                    <form action="/blogs/<%= blog._id %>?_method=DELETE" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-outline-danger ms-2"><i class="fa-solid fa-trash"></i></button>
                                    </form>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>
</main>